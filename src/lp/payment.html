<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±ºæ¸ˆ - emolink</title>
    <meta name="description" content="emolinkæ±ºæ¸ˆãƒšãƒ¼ã‚¸ - æ³¨æ–‡å†…å®¹ã®ç¢ºèªã¨ãŠæ”¯æ‰•ã„">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/main.css">
    
    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-container">
            <div class="nav-logo">
                <h1>emolink</h1>
            </div>
            <div class="nav-menu">
                <a href="/" class="nav-link">ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸</a>
            </div>
        </div>
    </nav>

    <!-- Payment Page -->
    <section class="payment-page">
        <div class="container">
            <h2 class="section-title">æ±ºæ¸ˆ</h2>
            
            <!-- ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
            <div class="step-indicator">
                <div class="step completed" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">ã‚µã‚¤ã‚ºé¸æŠ</div>
                </div>
                <div class="step completed" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">åŸºæœ¬æƒ…å ±</div>
                </div>
                <div class="step completed" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
                </div>
                <div class="step completed" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-label">é…é€å…ˆ</div>
                </div>
                <div class="step active" data-step="5">
                    <div class="step-number">5</div>
                    <div class="step-label">æ±ºæ¸ˆ</div>
                </div>
            </div>
            
            <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ -->
            <div class="progress-bar">
                <div class="progress" style="width: 100%"></div>
            </div>
            
            <!-- åŸºæœ¬æƒ…å ±å…¥åŠ› -->
            <div class="order-summary">
                <h3>åŸºæœ¬æƒ…å ±</h3>
                <div class="form-group">
                    <label for="email" class="form-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ *</label>
                    <input type="email" id="email" name="email" class="form-input" required placeholder="your@example.com">
                </div>
                <div class="form-group">
                    <label for="phone" class="form-label">é›»è©±ç•ªå· *</label>
                    <input type="tel" id="phone" name="phone" class="form-input" required placeholder="090-1234-5678">
                </div>
            </div>
            
            <!-- é…é€å…ˆå…¥åŠ› -->
            <div class="order-summary">
                <h3>é…é€å…ˆæƒ…å ±</h3>
                <div class="form-group">
                    <label for="shippingName" class="form-label">ãŠåå‰ *</label>
                    <input type="text" id="shippingName" name="shippingName" class="form-input" required placeholder="ç”°ä¸­å¤ªéƒ">
                </div>
                <div class="form-group">
                    <label for="postalCode" class="form-label">éƒµä¾¿ç•ªå· *</label>
                    <input type="text" id="postalCode" name="postalCode" class="form-input" required placeholder="123-4567">
                </div>
                <div class="form-group">
                    <label for="prefecture" class="form-label">éƒ½é“åºœçœŒ *</label>
                    <select id="prefecture" name="prefecture" class="form-input" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="åŒ—æµ·é“">åŒ—æµ·é“</option>
                        <option value="é’æ£®çœŒ">é’æ£®çœŒ</option>
                        <option value="å²©æ‰‹çœŒ">å²©æ‰‹çœŒ</option>
                        <option value="å®®åŸçœŒ">å®®åŸçœŒ</option>
                        <option value="ç§‹ç”°çœŒ">ç§‹ç”°çœŒ</option>
                        <option value="å±±å½¢çœŒ">å±±å½¢çœŒ</option>
                        <option value="ç¦å³¶çœŒ">ç¦å³¶çœŒ</option>
                        <option value="èŒ¨åŸçœŒ">èŒ¨åŸçœŒ</option>
                        <option value="æ ƒæœ¨çœŒ">æ ƒæœ¨çœŒ</option>
                        <option value="ç¾¤é¦¬çœŒ">ç¾¤é¦¬çœŒ</option>
                        <option value="åŸ¼ç‰çœŒ">åŸ¼ç‰çœŒ</option>
                        <option value="åƒè‘‰çœŒ">åƒè‘‰çœŒ</option>
                        <option value="æ±äº¬éƒ½">æ±äº¬éƒ½</option>
                        <option value="ç¥å¥ˆå·çœŒ">ç¥å¥ˆå·çœŒ</option>
                        <option value="æ–°æ½ŸçœŒ">æ–°æ½ŸçœŒ</option>
                        <option value="å¯Œå±±çœŒ">å¯Œå±±çœŒ</option>
                        <option value="çŸ³å·çœŒ">çŸ³å·çœŒ</option>
                        <option value="ç¦äº•çœŒ">ç¦äº•çœŒ</option>
                        <option value="å±±æ¢¨çœŒ">å±±æ¢¨çœŒ</option>
                        <option value="é•·é‡çœŒ">é•·é‡çœŒ</option>
                        <option value="å²é˜œçœŒ">å²é˜œçœŒ</option>
                        <option value="é™å²¡çœŒ">é™å²¡çœŒ</option>
                        <option value="æ„›çŸ¥çœŒ">æ„›çŸ¥çœŒ</option>
                        <option value="ä¸‰é‡çœŒ">ä¸‰é‡çœŒ</option>
                        <option value="æ»‹è³€çœŒ">æ»‹è³€çœŒ</option>
                        <option value="äº¬éƒ½åºœ">äº¬éƒ½åºœ</option>
                        <option value="å¤§é˜ªåºœ">å¤§é˜ªåºœ</option>
                        <option value="å…µåº«çœŒ">å…µåº«çœŒ</option>
                        <option value="å¥ˆè‰¯çœŒ">å¥ˆè‰¯çœŒ</option>
                        <option value="å’Œæ­Œå±±çœŒ">å’Œæ­Œå±±çœŒ</option>
                        <option value="é³¥å–çœŒ">é³¥å–çœŒ</option>
                        <option value="å³¶æ ¹çœŒ">å³¶æ ¹çœŒ</option>
                        <option value="å²¡å±±çœŒ">å²¡å±±çœŒ</option>
                        <option value="åºƒå³¶çœŒ">åºƒå³¶çœŒ</option>
                        <option value="å±±å£çœŒ">å±±å£çœŒ</option>
                        <option value="å¾³å³¶çœŒ">å¾³å³¶çœŒ</option>
                        <option value="é¦™å·çœŒ">é¦™å·çœŒ</option>
                        <option value="æ„›åª›çœŒ">æ„›åª›çœŒ</option>
                        <option value="é«˜çŸ¥çœŒ">é«˜çŸ¥çœŒ</option>
                        <option value="ç¦å²¡çœŒ">ç¦å²¡çœŒ</option>
                        <option value="ä½è³€çœŒ">ä½è³€çœŒ</option>
                        <option value="é•·å´çœŒ">é•·å´çœŒ</option>
                        <option value="ç†Šæœ¬çœŒ">ç†Šæœ¬çœŒ</option>
                        <option value="å¤§åˆ†çœŒ">å¤§åˆ†çœŒ</option>
                        <option value="å®®å´çœŒ">å®®å´çœŒ</option>
                        <option value="é¹¿å…å³¶çœŒ">é¹¿å…å³¶çœŒ</option>
                        <option value="æ²–ç¸„çœŒ">æ²–ç¸„çœŒ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="city" class="form-label">å¸‚åŒºç”ºæ‘ *</label>
                    <input type="text" id="city" name="city" class="form-input" required placeholder="æ¸‹è°·åŒº">
                </div>
                <div class="form-group">
                    <label for="address1" class="form-label">ä½æ‰€1ï¼ˆç•ªåœ°ãƒ»å»ºç‰©åï¼‰ *</label>
                    <input type="text" id="address1" name="address1" class="form-input" required placeholder="1-2-3 ãƒãƒ³ã‚·ãƒ§ãƒ³å">
                </div>
                <div class="form-group">
                    <label for="address2" class="form-label">ä½æ‰€2ï¼ˆéƒ¨å±‹ç•ªå·ãªã©ï¼‰</label>
                    <input type="text" id="address2" name="address2" class="form-input" placeholder="101å·å®¤">
                </div>
            </div>
            
            <!-- å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
            <div class="order-summary">
                <h3>å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h3>
                <div class="photo-upload-area" style="text-align: center;">
                    <input type="file" id="photoUpload" name="photoUpload" accept="image/*" onchange="handlePhotoUpload(this)" style="display: none;">
                    <div id="dropZone" style="border: 2px dashed #d1d5db; border-radius: 0.5rem; padding: 2rem; margin: 1rem 0; background: #f9fafb; transition: all 0.3s ease;" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                        <label for="photoUpload" style="display: inline-block; padding: 1rem 2rem; background: #2563eb; color: #ffffff; border-radius: 0.5rem; cursor: pointer; font-weight: 500; border: 2px solid #2563eb; transition: all 0.3s ease;">
                            å†™çœŸã‚’é¸æŠ
                        </label>
                        <p style="margin-top: 1rem; color: #6b7280;">ã¾ãŸã¯ã€ã“ã“ã«å†™çœŸã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</p>
                        <p style="margin-top: 0.5rem; color: #6b7280; font-size: 0.875rem;">1æšã®å†™çœŸã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆ5MBä»¥ä¸‹ï¼‰</p>
                    </div>
                    <div id="photoPreview" class="upload-preview" style="display: flex; justify-content: center; margin-top: 1.5rem;"></div>
                </div>
            </div>
            
            
            <!-- æ±ºæ¸ˆå‡¦ç† -->
            <div class="payment-section">
                <button id="submit-payment" class="btn btn-primary" style="width: 300px; margin: 0 auto; display: block;" onclick="console.log('ğŸ”˜ ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯'); showConfirmModal();">
                    <span class="btn-text" id="paymentButtonText">æ³¨æ–‡å†…å®¹ã‚’ç¢ºèªã—ã¦æ±ºæ¸ˆ</span>
                    <span class="btn-spinner" style="display: none;">å‡¦ç†ä¸­...</span>
                </button>
                
                <div class="payment-note" style="text-align: center; margin-top: 1rem;">
                    <p>â€» æ±ºæ¸ˆå®Œäº†å¾Œã€ç§˜å¯†éµã‚’ãƒ¡ãƒ¼ãƒ«ã§ãŠé€ã‚Šã„ãŸã—ã¾ã™</p>
                    <p>â€» ç§˜å¯†éµã§å°‚ç”¨ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦æƒ³ã„å‡ºãƒšãƒ¼ã‚¸ã‚’ä½œæˆã§ãã¾ã™</p>
                </div>
            </div>
        </div>
    </section>

    <!-- ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="confirmModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000;">
        <div style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%;">
            <div style="background: white; border-radius: 0.75rem; padding: 2rem; max-width: 500px; width: 90%; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);">
            <h3 style="color: #2563eb; margin: 0 0 1rem 0; font-size: 1.5rem; font-weight: 600;">æ³¨æ–‡å†…å®¹ã®ç¢ºèª</h3>
            
            <div id="modalProductInfo" style="margin-bottom: 1rem;">
                <!-- å‹•çš„ã«ç”Ÿæˆ -->
            </div>
            
            <div id="modalShippingInfo" style="margin-bottom: 1rem;">
                <!-- å‹•çš„ã«ç”Ÿæˆ -->
            </div>
            
            <div id="modalPhotoInfo" style="margin-bottom: 1rem;">
                <!-- å‹•çš„ã«ç”Ÿæˆ -->
            </div>
            
            <div style="border-top: 1px solid #e5e7eb; padding-top: 1rem; margin-top: 1rem;">
                <div style="margin-bottom: 0.75rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>å•†å“ä¾¡æ ¼</span>
                        <span id="modalItemPrice">-</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>é€æ–™</span>
                        <span>ç„¡æ–™</span>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 0.75rem; border-top: 1px solid #e5e7eb;">
                    <span style="font-weight: 600;">åˆè¨ˆé‡‘é¡</span>
                    <span id="modalTotalAmount" style="font-size: 1.25rem; font-weight: 700; color: #2563eb;"></span>
                </div>
            </div>
            
            <div style="text-align: center; margin-bottom: 1rem;">
                <p style="font-size: 0.875rem; color: #6b7280; margin: 0;">
                    <a href="/legal.html" target="_blank" style="color: #2563eb; text-decoration: underline;">ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜</a>ã‚’ç¢ºèªã®ä¸Šã€æ±ºæ¸ˆã‚’é€²ã‚ã¦ãã ã•ã„ã€‚
                </p>
            </div>
            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem;">
                <button onclick="closeConfirmModal()" style="padding: 0.75rem 1.5rem; border: 2px solid #6b7280; background: white; color: #6b7280; border-radius: 0.5rem; cursor: pointer; font-weight: 500;">
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                <button onclick="proceedToPayment()" style="padding: 0.75rem 1.5rem; background: #2563eb; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 500;">
                    Stripe æ±ºæ¸ˆãƒšãƒ¼ã‚¸ã¸é·ç§»
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>emolink</h3>
                    <p>å¤§åˆ‡ãªæƒ³ã„å‡ºã‚’æ°¸é ã«</p>
                </div>
                <div class="footer-column">
                    <h4>ã‚µãƒ¼ãƒ“ã‚¹</h4>
                    <ul>
                        <li><a href="/#experience">ä½“é¨“ã‚¤ãƒ¡ãƒ¼ã‚¸</a></li>
                        <li><a href="/#demo">ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸</a></li>
                        <li><a href="/#price">æ–™é‡‘</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>ã‚µãƒãƒ¼ãƒˆ</h4>
                    <ul>
                        <li><a href="mailto:office@futurestudio.co.jp">ãŠå•ã„åˆã‚ã›</a></li>
                        <li><a href="/legal.html">ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 emolink. All rights reserved.</p>
                <p style="font-size: 12px; color: #6b7280; margin-top: 8px;">v1.1.1</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <!-- payment-page.jsã¯ç„¡åŠ¹åŒ–ï¼ˆStripe Payment Linkæ–¹å¼ã®ãŸã‚ï¼‰ -->
    <!-- <script type="module" src="js/payment-page.js"></script> -->
    
    <script>
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®ãƒ­ã‚°
        console.log('ğŸ“„ payment.html ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
        
        // ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function showConfirmModal() {
            console.log('ğŸ” showConfirmModal() ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã—ãŸ');
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã®å…¥åŠ›å†…å®¹ã‚’å–å¾—
            const formData = getFormData();
            console.log('ğŸ“‹ ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿:', formData);
            
            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (!validateForm(formData)) {
                console.log('âŒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—');
                return;
            }
            
            console.log('âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸ');
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®å†…å®¹ã‚’æ›´æ–°
            updateModalContent(formData);
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            document.getElementById('confirmModal').style.display = 'block';
            console.log('ğŸ“± ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ');
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹é–¢æ•°
        function getFormData() {
            return {
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                shippingName: document.getElementById('shippingName').value,
                postalCode: document.getElementById('postalCode').value,
                prefecture: document.getElementById('prefecture').value,
                city: document.getElementById('city').value,
                address1: document.getElementById('address1').value,
                address2: document.getElementById('address2').value,
                photo: document.getElementById('photoUpload').files[0],
                selectedProduct: JSON.parse(localStorage.getItem('selectedProduct') || '{}')
            };
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        function validateForm(data) {
            const requiredFields = ['email', 'phone', 'shippingName', 'postalCode', 'prefecture', 'city', 'address1'];
            
            for (const field of requiredFields) {
                if (!data[field]) {
                    alert(`${getFieldLabel(field)}ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„`);
                    return false;
                }
            }
            
            if (!data.selectedProduct.size || !data.selectedProduct.price) {
                alert('å•†å“ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return false;
            }
            
            return true;
        }
        
        // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ©ãƒ™ãƒ«ã‚’å–å¾—
        function getFieldLabel(field) {
            const labels = {
                email: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹',
                phone: 'é›»è©±ç•ªå·',
                shippingName: 'ãŠåå‰',
                postalCode: 'éƒµä¾¿ç•ªå·',
                prefecture: 'éƒ½é“åºœçœŒ',
                city: 'å¸‚åŒºç”ºæ‘',
                address1: 'ä½æ‰€1'
            };
            return labels[field] || field;
        }
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®å†…å®¹ã‚’æ›´æ–°
        function updateModalContent(data) {
            // å•†å“æƒ…å ±
            document.getElementById('modalProductInfo').innerHTML = `
                <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #2563eb;">å•†å“æƒ…å ±</h4>
                    <p style="margin: 0;">${data.selectedProduct.size} ã‚µã‚¤ã‚º - Â¥${data.selectedProduct.price.toLocaleString()}ï¼ˆç¨è¾¼ï¼‰</p>
                </div>
            `;
            
            // é…é€å…ˆæƒ…å ±
            document.getElementById('modalShippingInfo').innerHTML = `
                <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #2563eb;">é…é€å…ˆ</h4>
                    <p style="margin: 0 0 0.25rem 0;">${data.shippingName}</p>
                    <p style="margin: 0;">${data.postalCode} ${data.prefecture} ${data.city} ${data.address1} ${data.address2}</p>
                </div>
            `;
            
            // å†™çœŸæƒ…å ±
            const photoInfo = data.photo ? 
                `<div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #2563eb;">å†™çœŸ</h4>
                    <p style="margin: 0;">${data.photo.name}</p>
                </div>` :
                `<div style="background: #fef2f2; padding: 1rem; border-radius: 0.5rem; border: 1px solid #fecaca;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #ef4444;">å†™çœŸ</h4>
                    <p style="margin: 0; color: #ef4444;">å†™çœŸãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
                </div>`;
            document.getElementById('modalPhotoInfo').innerHTML = photoInfo;
            
            // å•†å“ä¾¡æ ¼ã¨åˆè¨ˆé‡‘é¡
            document.getElementById('modalItemPrice').textContent = `Â¥${data.selectedProduct.price.toLocaleString()}ï¼ˆç¨è¾¼ï¼‰`;
            document.getElementById('modalTotalAmount').textContent = `Â¥${data.selectedProduct.price.toLocaleString()}ï¼ˆç¨è¾¼ï¼‰`;
        }
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹é–¢æ•°
        function closeConfirmModal() {
            document.getElementById('confirmModal').style.display = 'none';
        }
        
        // Stripe Checkoutã¸é·ç§»ã™ã‚‹é–¢æ•°
        // Stripe Checkout Sessionä½œæˆã—ã¦é·ç§»ã™ã‚‹é–¢æ•°
        async function proceedToPayment() {
            console.log('ğŸš€ proceedToPayment() ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã—ãŸ');
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            closeConfirmModal();
            
            // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const formData = getFormData();
            console.log('ğŸ“‹ proceedToPayment ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿:', formData);
            
            try {
                // Firebase Functionsã®Checkout Sessionä½œæˆAPIã‚’å‘¼ã³å‡ºã—
                const response = await fetch('https://asia-northeast1-memorylink-cms.cloudfunctions.net/api/create-checkout-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        productInfo: formData.selectedProduct,
                        customerInfo: {
                            email: formData.email,
                            phone: formData.phone,
                            shippingInfo: formData.shippingInfo
                        },
                        photo: formData.photo
                    })
                });
                
                const result = await response.json();
                console.log('ğŸ”— Checkout Sessionä½œæˆçµæœ:', result);
                
                if (result.success && result.checkoutUrl) {
                    // Stripe Checkoutãƒšãƒ¼ã‚¸ã«é·ç§»
                    window.location.href = result.checkoutUrl;
                } else {
                    alert('æ±ºæ¸ˆãƒšãƒ¼ã‚¸ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
                }
                
            } catch (error) {
                console.error('âŒ Checkout Sessionä½œæˆã‚¨ãƒ©ãƒ¼:', error);
                alert('æ±ºæ¸ˆãƒšãƒ¼ã‚¸ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
            }
        }
        
        // å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        function handlePhotoUpload(input) {
            const file = input.files[0];
            const preview = document.getElementById('photoPreview');
            const label = document.querySelector('label[for="photoUpload"]');
            
            if (file) {
                console.log('ğŸ“¸ å†™çœŸãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ:', file.name, file.size, file.type);
                
                // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆ5MBä»¥ä¸‹ï¼‰
                if (file.size > 5 * 1024 * 1024) {
                    alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ã€‚5MBä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                    input.value = '';
                    preview.innerHTML = '';
                    return;
                }
                
                // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‹ãƒã‚§ãƒƒã‚¯
                if (!file.type.startsWith('image/')) {
                    alert('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                    input.value = '';
                    preview.innerHTML = '';
                    return;
                }
                
                // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <div style="text-align: center;">
                            <img src="${e.target.result}" alt="ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸå†™çœŸ" style="max-width: 300px; max-height: 300px; border-radius: 8px; border: 2px solid #e5e7eb; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                            <p style="margin-top: 0.5rem; color: #6b7280; font-size: 0.875rem;">${file.name}</p>
                            <button type="button" onclick="removePhoto()" style="margin-top: 0.5rem; padding: 0.5rem 1rem; background: #ef4444; color: white; border: none; border-radius: 0.375rem; cursor: pointer; font-size: 0.875rem;">
                                å†™çœŸã‚’å‰Šé™¤
                            </button>
                        </div>
                    `;
                    
                    // ãƒ©ãƒ™ãƒ«ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å¤‰æ›´
                    if (label) {
                        label.textContent = 'å†™çœŸã‚’å¤‰æ›´';
                        label.style.background = '#10b981';
                        label.style.borderColor = '#10b981';
                    }
                };
                reader.readAsDataURL(file);
            } else {
                preview.innerHTML = '';
                if (label) {
                    label.textContent = 'å†™çœŸã‚’é¸æŠ';
                    label.style.background = '#2563eb';
                    label.style.borderColor = '#2563eb';
                }
            }
        }
        
        // å†™çœŸã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°
        function removePhoto() {
            const input = document.getElementById('photoUpload');
            const preview = document.getElementById('photoPreview');
            const label = document.querySelector('label[for="photoUpload"]');
            
            input.value = '';
            preview.innerHTML = '';
            
            if (label) {
                label.textContent = 'å†™çœŸã‚’é¸æŠ';
                label.style.background = '#2563eb';
                label.style.borderColor = '#2563eb';
            }
        }
        
        // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†
        function handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            const dropZone = document.getElementById('dropZone');
            dropZone.style.borderColor = '#2563eb';
            dropZone.style.background = '#eff6ff';
        }
        
        function handleDragLeave(event) {
            event.preventDefault();
            event.stopPropagation();
            const dropZone = document.getElementById('dropZone');
            dropZone.style.borderColor = '#d1d5db';
            dropZone.style.background = '#f9fafb';
        }
        
        function handleDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            
            const dropZone = document.getElementById('dropZone');
            dropZone.style.borderColor = '#d1d5db';
            dropZone.style.background = '#f9fafb';
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                const input = document.getElementById('photoUpload');
                
                // FileListã‚’è¨­å®š
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                input.files = dataTransfer.files;
                
                // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã‚’å®Ÿè¡Œ
                handlePhotoUpload(input);
            }
        }
    </script>
</body>
</html>
