<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Т▒║ТИѕ - emolink</title>
    <meta name="description" content="emolinkТ▒║ТИѕсЃџсЃ╝сѓИ - Т│еТќЄтєЁт«╣сЂ«уб║УфЇсЂесЂіТћ»ТЅЋсЂё">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/main.css">
    
    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-container">
            <div class="nav-logo">
                <h1>emolink</h1>
            </div>
            <div class="nav-menu">
                <a href="/" class="nav-link">сЃѕсЃЃсЃЌсЃџсЃ╝сѓИ</a>
            </div>
        </div>
    </nav>

    <!-- Payment Page -->
    <section class="payment-page">
        <div class="container">
            <h2 class="section-title">Т▒║ТИѕ</h2>
            
            <!-- сѓ╣сЃєсЃЃсЃЌсѓцсЃ│сѓИсѓ▒сЃ╝сѓ┐сЃ╝ -->
            <div class="step-indicator">
                <div class="step completed" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">сѓхсѓцсѓ║жЂИТіъ</div>
                </div>
                <div class="step completed" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">тЪ║ТюгТЃЁта▒</div>
                </div>
                <div class="step completed" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">тєЎуюЪсѓбсЃЃсЃЌсЃГсЃ╝сЃЅ</div>
                </div>
                <div class="step completed" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-label">жЁЇжђЂтЁѕ</div>
                </div>
                <div class="step active" data-step="5">
                    <div class="step-number">5</div>
                    <div class="step-label">Т▒║ТИѕ</div>
                </div>
            </div>
            
            <!-- сЃЌсЃГсѓ░сЃгсѓ╣сЃљсЃ╝ -->
            <div class="progress-bar">
                <div class="progress" style="width: 100%"></div>
            </div>
            
            <!-- тЪ║ТюгТЃЁта▒тЁЦтіЏ -->
            <div class="order-summary">
                <h3>тЪ║ТюгТЃЁта▒</h3>
                <div class="form-group">
                    <label for="email" class="form-label">сЃАсЃ╝сЃФсѓбсЃЅсЃгсѓ╣ *</label>
                    <input type="email" id="email" name="email" class="form-input" required placeholder="your@example.com">
                </div>
                <div class="form-group">
                    <label for="phone" class="form-label">жЏ╗УЕ▒уЋфтЈи *</label>
                    <input type="tel" id="phone" name="phone" class="form-input" required placeholder="090-1234-5678">
                </div>
            </div>
            
            <!-- жЁЇжђЂтЁѕтЁЦтіЏ -->
            <div class="order-summary">
                <h3>жЁЇжђЂтЁѕТЃЁта▒</h3>
                <div class="form-group">
                    <label for="shippingName" class="form-label">сЂітљЇтЅЇ *</label>
                    <input type="text" id="shippingName" name="shippingName" class="form-input" required placeholder="ућ░СИГтцфжЃј">
                </div>
                <div class="form-group">
                    <label for="postalCode" class="form-label">жЃхСЙ┐уЋфтЈи *</label>
                    <input type="text" id="postalCode" name="postalCode" class="form-input" required placeholder="123-4567">
                </div>
                <div class="form-group">
                    <label for="prefecture" class="form-label">жЃйжЂЊт║юуюї *</label>
                    <select id="prefecture" name="prefecture" class="form-input" required>
                        <option value="">жЂИТіъсЂЌсЂдсЂЈсЂасЂЋсЂё</option>
                        <option value="тїЌТхижЂЊ">тїЌТхижЂЊ</option>
                        <option value="жЮњТБ«уюї">жЮњТБ«уюї</option>
                        <option value="т▓ЕТЅІуюї">т▓ЕТЅІуюї</option>
                        <option value="т««тЪјуюї">т««тЪјуюї</option>
                        <option value="уДІућ░уюї">уДІућ░уюї</option>
                        <option value="т▒▒тйбуюї">т▒▒тйбуюї</option>
                        <option value="удЈт│Хуюї">удЈт│Хуюї</option>
                        <option value="УїетЪјуюї">УїетЪјуюї</option>
                        <option value="ТаЃТюеуюї">ТаЃТюеуюї</option>
                        <option value="уЙцждгуюї">уЙцждгуюї</option>
                        <option value="тЪ╝ујЅуюї">тЪ╝ујЅуюї</option>
                        <option value="тЇЃУЉЅуюї">тЇЃУЉЅуюї</option>
                        <option value="ТЮ▒С║гжЃй">ТЮ▒С║гжЃй</option>
                        <option value="уЦътЦѕтиЮуюї">уЦътЦѕтиЮуюї</option>
                        <option value="Тќ░ТйЪуюї">Тќ░ТйЪуюї</option>
                        <option value="т»їт▒▒уюї">т»їт▒▒уюї</option>
                        <option value="уЪ│тиЮуюї">уЪ│тиЮуюї</option>
                        <option value="удЈС║Ћуюї">удЈС║Ћуюї</option>
                        <option value="т▒▒Тбеуюї">т▒▒Тбеуюї</option>
                        <option value="жЋижЄјуюї">жЋижЄјуюї</option>
                        <option value="т▓љжўюуюї">т▓љжўюуюї</option>
                        <option value="жЮЎт▓Ауюї">жЮЎт▓Ауюї</option>
                        <option value="ТёЏуЪЦуюї">ТёЏуЪЦуюї</option>
                        <option value="СИЅжЄЇуюї">СИЅжЄЇуюї</option>
                        <option value="Т╗ІУ│ђуюї">Т╗ІУ│ђуюї</option>
                        <option value="С║гжЃйт║ю">С║гжЃйт║ю</option>
                        <option value="тцДжўфт║ю">тцДжўфт║ю</option>
                        <option value="тЁхт║Фуюї">тЁхт║Фуюї</option>
                        <option value="тЦѕУЅ»уюї">тЦѕУЅ»уюї</option>
                        <option value="тњїТГїт▒▒уюї">тњїТГїт▒▒уюї</option>
                        <option value="ж│ЦтЈќуюї">ж│ЦтЈќуюї</option>
                        <option value="т│ХТа╣уюї">т│ХТа╣уюї</option>
                        <option value="т▓Ат▒▒уюї">т▓Ат▒▒уюї</option>
                        <option value="т║Ѓт│Хуюї">т║Ѓт│Хуюї</option>
                        <option value="т▒▒тЈБуюї">т▒▒тЈБуюї</option>
                        <option value="тЙ│т│Хуюї">тЙ│т│Хуюї</option>
                        <option value="ждЎтиЮуюї">ждЎтиЮуюї</option>
                        <option value="ТёЏтфЏуюї">ТёЏтфЏуюї</option>
                        <option value="жФўуЪЦуюї">жФўуЪЦуюї</option>
                        <option value="удЈт▓Ауюї">удЈт▓Ауюї</option>
                        <option value="СйљУ│ђуюї">СйљУ│ђуюї</option>
                        <option value="жЋит┤јуюї">жЋит┤јуюї</option>
                        <option value="уєіТюгуюї">уєіТюгуюї</option>
                        <option value="тцДтѕєуюї">тцДтѕєуюї</option>
                        <option value="т««т┤јуюї">т««т┤јуюї</option>
                        <option value="ж╣┐тЁљт│Хуюї">ж╣┐тЁљт│Хуюї</option>
                        <option value="Т▓ќуИёуюї">Т▓ќуИёуюї</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="city" class="form-label">тИѓтї║ућ║ТЮЉ *</label>
                    <input type="text" id="city" name="city" class="form-input" required placeholder="ТИІУ░итї║">
                </div>
                <div class="form-group">
                    <label for="address1" class="form-label">СйЈТЅђ1№╝ѕуЋфтю░сЃ╗т╗║уЅЕтљЇ№╝Ѕ *</label>
                    <input type="text" id="address1" name="address1" class="form-input" required placeholder="1-2-3 сЃъсЃ│сѓисЃДсЃ│тљЇ">
                </div>
                <div class="form-group">
                    <label for="address2" class="form-label">СйЈТЅђ2№╝ѕжЃет▒ІуЋфтЈисЂфсЂЕ№╝Ѕ</label>
                    <input type="text" id="address2" name="address2" class="form-input" placeholder="101тЈит«ц">
                </div>
            </div>
            
            <!-- тєЎуюЪсѓбсЃЃсЃЌсЃГсЃ╝сЃЅ -->
            <div class="order-summary">
                <h3>тєЎуюЪсѓбсЃЃсЃЌсЃГсЃ╝сЃЅ</h3>
                <div class="photo-upload-area" style="text-align: center;">
                    <input type="file" id="photoUpload" name="photoUpload" accept="image/*" onchange="handlePhotoUpload(this)" style="display: none;">
                    <div id="dropZone" style="border: 2px dashed #d1d5db; border-radius: 0.5rem; padding: 2rem; margin: 1rem 0; background: #f9fafb; transition: all 0.3s ease;" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                        <label for="photoUpload" style="display: inline-block; padding: 1rem 2rem; background: #2563eb; color: #ffffff; border-radius: 0.5rem; cursor: pointer; font-weight: 500; border: 2px solid #2563eb; transition: all 0.3s ease;">
                            тєЎуюЪсѓњжЂИТіъ
                        </label>
                        <p style="margin-top: 1rem; color: #6b7280;">сЂЙсЂЪсЂ»сђЂсЂЊсЂЊсЂФтєЎуюЪсѓњсЃЅсЃЕсЃЃсѓ░&сЃЅсЃГсЃЃсЃЌ</p>
                        <p style="margin-top: 0.5rem; color: #6b7280; font-size: 0.875rem;">1ТъџсЂ«тєЎуюЪсѓњжЂИТіъсЂЌсЂдсЂЈсЂасЂЋсЂё№╝ѕ5MBС╗ЦСИІ№╝Ѕ</p>
                    </div>
                    <div id="photoPreview" class="upload-preview" style="display: flex; justify-content: center; margin-top: 1.5rem;"></div>
                </div>
            </div>
            
            
            <!-- Т▒║ТИѕтЄдуљє -->
            <div class="payment-section">
                <button id="submit-payment" class="btn btn-primary" style="width: 300px; margin: 0 auto; display: block;" onclick="console.log('­Ъћў сЃюсѓ┐сЃ│сѓ»сЃфсЃЃсѓ»'); showConfirmModal();">
                    <span class="btn-text" id="paymentButtonText">Т│еТќЄтєЁт«╣сѓњуб║УфЇсЂЌсЂдТ▒║ТИѕ</span>
                    <span class="btn-spinner" style="display: none;">тЄдуљєСИГ...</span>
                </button>
                
                <div class="payment-note" style="text-align: center; margin-top: 1rem;">
                    <p>Рђ╗ Т▒║ТИѕт«їС║єтЙїсђЂуДўт»єжЇхсѓњсЃАсЃ╝сЃФсЂДсЂіжђЂсѓісЂёсЂЪсЂЌсЂЙсЂЎ</p>
                    <p>Рђ╗ уДўт»єжЇхсЂДт░ѓућесѓхсѓцсЃѕсЂФсѓбсѓ»сѓ╗сѓ╣сЂЌсЂдТЃ│сЂётЄ║сЃџсЃ╝сѓИсѓњСйюТѕљсЂДсЂЇсЂЙсЂЎ</p>
                </div>
            </div>
        </div>
    </section>

    <!-- уб║УфЇсЃбсЃ╝сЃђсЃФ -->
    <div id="confirmModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000;">
        <div style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%;">
            <div style="background: white; border-radius: 0.75rem; padding: 2rem; max-width: 500px; width: 90%; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);">
            <h3 style="color: #2563eb; margin: 0 0 1rem 0; font-size: 1.5rem; font-weight: 600;">Т│еТќЄтєЁт«╣сЂ«уб║УфЇ</h3>
            
            <div id="modalProductInfo" style="margin-bottom: 1rem;">
                <!-- тІЋуџёсЂФућЪТѕљ -->
            </div>
            
            <div id="modalShippingInfo" style="margin-bottom: 1rem;">
                <!-- тІЋуџёсЂФућЪТѕљ -->
            </div>
            
            <div id="modalPhotoInfo" style="margin-bottom: 1rem;">
                <!-- тІЋуџёсЂФућЪТѕљ -->
            </div>
            
            <div style="border-top: 1px solid #e5e7eb; padding-top: 1rem; margin-top: 1rem;">
                <div style="margin-bottom: 0.75rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>тЋєтЊЂСЙАТа╝</span>
                        <span id="modalItemPrice">-</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>жђЂТќЎ</span>
                        <span>уёАТќЎ</span>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 0.75rem; border-top: 1px solid #e5e7eb;">
                    <span style="font-weight: 600;">тљѕУеѕжЄЉжАЇ</span>
                    <span id="modalTotalAmount" style="font-size: 1.25rem; font-weight: 700; color: #2563eb;"></span>
                </div>
            </div>
            
            <div style="text-align: center; margin-bottom: 1rem;">
                <p style="font-size: 0.875rem; color: #6b7280; margin: 0;">
                    <a href="/legal.html" target="_blank" style="color: #2563eb; text-decoration: underline;">уЅ╣т«џтЋєтЈќт╝ЋТ│ЋсЂФтЪ║сЂЦсЂЈУАеУеў</a>сѓњуб║УфЇсЂ«СИісђЂТ▒║ТИѕсѓњжђ▓сѓЂсЂдсЂЈсЂасЂЋсЂёсђѓ
                </p>
            </div>
            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem;">
                <button onclick="closeConfirmModal()" style="padding: 0.75rem 1.5rem; border: 2px solid #6b7280; background: white; color: #6b7280; border-radius: 0.5rem; cursor: pointer; font-weight: 500;">
                    сѓГсЃБсЃ│сѓ╗сЃФ
                </button>
                <button onclick="proceedToPayment()" style="padding: 0.75rem 1.5rem; background: #2563eb; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 500;">
                    Stripe Т▒║ТИѕсЃџсЃ╝сѓИсЂИжЂиуД╗
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>emolink</h3>
                    <p>тцДтѕЄсЂфТЃ│сЂётЄ║сѓњТ░ИжЂасЂФ</p>
                </div>
                <div class="footer-column">
                    <h4>сѓхсЃ╝сЃЊсѓ╣</h4>
                    <ul>
                        <li><a href="/#experience">СйЊжеЊсѓцсЃАсЃ╝сѓИ</a></li>
                        <li><a href="/#demo">сЃЄсЃбсЃџсЃ╝сѓИ</a></li>
                        <li><a href="/#price">ТќЎжЄЉ</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>сѓхсЃЮсЃ╝сЃѕ</h4>
                    <ul>
                        <li><a href="mailto:office@futurestudio.co.jp">сЂітЋЈсЂётљѕсѓЈсЂЏ</a></li>
                        <li><a href="/legal.html">уЅ╣т«џтЋєтЈќт╝ЋТ│ЋсЂФтЪ║сЂЦсЂЈУАеУеў</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 emolink. All rights reserved.</p>
                <p style="font-size: 12px; color: #6b7280; margin-top: 8px;">v1.1.1</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <!-- payment-page.jsсЂ»уёАті╣тїќ№╝ѕStripe Payment LinkТќ╣т╝ЈсЂ«сЂЪсѓЂ№╝Ѕ -->
    <!-- <script type="module" src="js/payment-page.js"></script> -->
    
    <script>
        // сЃџсЃ╝сѓИУфГсЂ┐УЙ╝сЂ┐ТЎѓсЂ«сЃГсѓ░
        console.log('­ЪЊё payment.html сЂїУфГсЂ┐УЙ╝сЂЙсѓїсЂЙсЂЌсЂЪ');
        
        // уб║УфЇсЃбсЃ╝сЃђсЃФсѓњУАеуц║сЂЎсѓІжќбТЋ░
        function showConfirmModal() {
            console.log('­ЪћЇ showConfirmModal() сЂїтЉ╝сЂ│тЄ║сЂЋсѓїсЂЙсЂЌсЂЪ');
            
            // сЃЋсѓЕсЃ╝сЃасЂ«тЁЦтіЏтєЁт«╣сѓњтЈќтЙЌ
            const formData = getFormData();
            console.log('­ЪЊІ сЃЋсѓЕсЃ╝сЃасЃЄсЃ╝сѓ┐:', formData);
            
            // сЃљсЃфсЃЄсЃ╝сѓисЃДсЃ│
            if (!validateForm(formData)) {
                console.log('РЮї сЃљсЃфсЃЄсЃ╝сѓисЃДсЃ│тц▒ТЋЌ');
                return;
            }
            
            console.log('РюЁ сЃљсЃфсЃЄсЃ╝сѓисЃДсЃ│ТѕљтіЪ');
            
            // сЃбсЃ╝сЃђсЃФсЂ«тєЁт«╣сѓњТЏ┤Тќ░
            updateModalContent(formData);
            
            // сЃбсЃ╝сЃђсЃФсѓњУАеуц║
            document.getElementById('confirmModal').style.display = 'block';
            console.log('­ЪЊ▒ уб║УфЇсЃбсЃ╝сЃђсЃФсѓњУАеуц║сЂЌсЂЙсЂЌсЂЪ');
        }
        
        // сЃЋсѓЕсЃ╝сЃасЃЄсЃ╝сѓ┐сѓњтЈќтЙЌсЂЎсѓІжќбТЋ░
        function getFormData() {
            return {
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                shippingName: document.getElementById('shippingName').value,
                postalCode: document.getElementById('postalCode').value,
                prefecture: document.getElementById('prefecture').value,
                city: document.getElementById('city').value,
                address1: document.getElementById('address1').value,
                address2: document.getElementById('address2').value,
                photo: document.getElementById('photoUpload').files[0],
                selectedProduct: JSON.parse(localStorage.getItem('selectedProduct') || '{}')
            };
        }
        
        // сЃЋсѓЕсЃ╝сЃасЂ«сЃљсЃфсЃЄсЃ╝сѓисЃДсЃ│
        function validateForm(data) {
            const requiredFields = ['email', 'phone', 'shippingName', 'postalCode', 'prefecture', 'city', 'address1'];
            
            for (const field of requiredFields) {
                if (!data[field]) {
                    alert(`${getFieldLabel(field)}сѓњтЁЦтіЏсЂЌсЂдсЂЈсЂасЂЋсЂё`);
                    return false;
                }
            }
            
            if (!data.selectedProduct.size || !data.selectedProduct.price) {
                alert('тЋєтЊЂсЂїжЂИТіъсЂЋсѓїсЂдсЂёсЂЙсЂЏсѓЊ');
                return false;
            }
            
            return true;
        }
        
        // сЃЋсѓБсЃ╝сЃФсЃЅсЃЕсЃЎсЃФсѓњтЈќтЙЌ
        function getFieldLabel(field) {
            const labels = {
                email: 'сЃАсЃ╝сЃФсѓбсЃЅсЃгсѓ╣',
                phone: 'жЏ╗УЕ▒уЋфтЈи',
                shippingName: 'сЂітљЇтЅЇ',
                postalCode: 'жЃхСЙ┐уЋфтЈи',
                prefecture: 'жЃйжЂЊт║юуюї',
                city: 'тИѓтї║ућ║ТЮЉ',
                address1: 'СйЈТЅђ1'
            };
            return labels[field] || field;
        }
        
        // сЃбсЃ╝сЃђсЃФсЂ«тєЁт«╣сѓњТЏ┤Тќ░
        function updateModalContent(data) {
            // тЋєтЊЂТЃЁта▒
            document.getElementById('modalProductInfo').innerHTML = `
                <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #2563eb;">тЋєтЊЂТЃЁта▒</h4>
                    <p style="margin: 0;">${data.selectedProduct.size} сѓхсѓцсѓ║ - ┬Ц${data.selectedProduct.price.toLocaleString()}№╝ѕуејУЙ╝№╝Ѕ</p>
                </div>
            `;
            
            // жЁЇжђЂтЁѕТЃЁта▒
            document.getElementById('modalShippingInfo').innerHTML = `
                <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #2563eb;">жЁЇжђЂтЁѕ</h4>
                    <p style="margin: 0 0 0.25rem 0;">${data.shippingName}</p>
                    <p style="margin: 0;">${data.postalCode} ${data.prefecture} ${data.city} ${data.address1} ${data.address2}</p>
                </div>
            `;
            
            // тєЎуюЪТЃЁта▒
            const photoInfo = data.photo ? 
                `<div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #2563eb;">тєЎуюЪ</h4>
                    <p style="margin: 0;">${data.photo.name}</p>
                </div>` :
                `<div style="background: #fef2f2; padding: 1rem; border-radius: 0.5rem; border: 1px solid #fecaca;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #ef4444;">тєЎуюЪ</h4>
                    <p style="margin: 0; color: #ef4444;">тєЎуюЪсЂїсѓбсЃЃсЃЌсЃГсЃ╝сЃЅсЂЋсѓїсЂдсЂёсЂЙсЂЏсѓЊ</p>
                </div>`;
            document.getElementById('modalPhotoInfo').innerHTML = photoInfo;
            
            // тЋєтЊЂСЙАТа╝сЂетљѕУеѕжЄЉжАЇ
            document.getElementById('modalItemPrice').textContent = `┬Ц${data.selectedProduct.price.toLocaleString()}№╝ѕуејУЙ╝№╝Ѕ`;
            document.getElementById('modalTotalAmount').textContent = `┬Ц${data.selectedProduct.price.toLocaleString()}№╝ѕуејУЙ╝№╝Ѕ`;
        }
        
        // сЃбсЃ╝сЃђсЃФсѓњжќЅсЂўсѓІжќбТЋ░
        function closeConfirmModal() {
            document.getElementById('confirmModal').style.display = 'none';
        }
        
        // Stripe CheckoutсЂИжЂиуД╗сЂЎсѓІжќбТЋ░
        // Stripe Checkout SessionСйюТѕљсЂЌсЂджЂиуД╗сЂЎсѓІжќбТЋ░
        async function proceedToPayment() {
            console.log('­Ъџђ proceedToPayment() сЂїтЉ╝сЂ│тЄ║сЂЋсѓїсЂЙсЂЌсЂЪ');
            
            // сЃбсЃ╝сЃђсЃФсѓњжќЅсЂўсѓІ
            closeConfirmModal();
            
            // сЃЋсѓЕсЃ╝сЃасЃЄсЃ╝сѓ┐сѓњтЈќтЙЌ
            const formData = getFormData();
            console.log('­ЪЊІ proceedToPayment сЃЋсѓЕсЃ╝сЃасЃЄсЃ╝сѓ┐:', formData);
            
            try {
                // Firebase FunctionsсЂ«Checkout SessionСйюТѕљAPIсѓњтЉ╝сЂ│тЄ║сЂЌ
                const response = await fetch('https://asia-northeast1-memorylink-cms.cloudfunctions.net/api/create-checkout-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        productInfo: formData.selectedProduct,
                        customerInfo: {
                            email: formData.email,
                            phone: formData.phone,
                            shippingInfo: formData.shippingInfo
                        },
                        photo: formData.photo
                    })
                });
                
                const result = await response.json();
                console.log('­ЪћЌ Checkout SessionСйюТѕљухљТъю:', result);
                
                if (result.success && result.checkoutUrl) {
                    // Stripe CheckoutсЃџсЃ╝сѓИсЂФжЂиуД╗
                    window.location.href = result.checkoutUrl;
                } else {
                    alert('Т▒║ТИѕсЃџсЃ╝сѓИсЂ«СйюТѕљсЂФтц▒ТЋЌсЂЌсЂЙсЂЌсЂЪсђѓсѓѓсЂєСИђт║дсЂіУЕдсЂЌсЂЈсЂасЂЋсЂёсђѓ');
                }
                
            } catch (error) {
                console.error('РЮї Checkout SessionСйюТѕљсѓесЃЕсЃ╝:', error);
                alert('Т▒║ТИѕсЃџсЃ╝сѓИсЂ«СйюТѕљсЂФтц▒ТЋЌсЂЌсЂЙсЂЌсЂЪсђѓсѓѓсЂєСИђт║дсЂіУЕдсЂЌсЂЈсЂасЂЋсЂёсђѓ');
            }
        }
        
        // тєЎуюЪсѓбсЃЃсЃЌсЃГсЃ╝сЃЅтЄдуљє
        function handlePhotoUpload(input) {
            const file = input.files[0];
            const preview = document.getElementById('photoPreview');
            const label = document.querySelector('label[for="photoUpload"]');
            
            if (file) {
                console.log('­ЪЊИ тєЎуюЪсЃЋсѓАсѓцсЃФжЂИТіъ:', file.name, file.size, file.type);
                
                // сЃЋсѓАсѓцсЃФсѓхсѓцсѓ║сЃЂсѓДсЃЃсѓ»№╝ѕ5MBС╗ЦСИІ№╝Ѕ
                if (file.size > 5 * 1024 * 1024) {
                    alert('сЃЋсѓАсѓцсЃФсѓхсѓцсѓ║сЂїтцДсЂЇсЂЎсЂјсЂЙсЂЎсђѓ5MBС╗ЦСИІсЂ«сЃЋсѓАсѓцсЃФсѓњжЂИТіъсЂЌсЂдсЂЈсЂасЂЋсЂёсђѓ');
                    input.value = '';
                    preview.innerHTML = '';
                    return;
                }
                
                // ућ╗тЃЈсЃЋсѓАсѓцсЃФсЂІсЃЂсѓДсЃЃсѓ»
                if (!file.type.startsWith('image/')) {
                    alert('ућ╗тЃЈсЃЋсѓАсѓцсЃФсѓњжЂИТіъсЂЌсЂдсЂЈсЂасЂЋсЂёсђѓ');
                    input.value = '';
                    preview.innerHTML = '';
                    return;
                }
                
                // сЃЌсЃгсЃЊсЃЦсЃ╝УАеуц║
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <div style="text-align: center;">
                            <img src="${e.target.result}" alt="сѓбсЃЃсЃЌсЃГсЃ╝сЃЅсЂЋсѓїсЂЪтєЎуюЪ" style="max-width: 300px; max-height: 300px; border-radius: 8px; border: 2px solid #e5e7eb; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                            <p style="margin-top: 0.5rem; color: #6b7280; font-size: 0.875rem;">${file.name}</p>
                            <button type="button" onclick="removePhoto()" style="margin-top: 0.5rem; padding: 0.5rem 1rem; background: #ef4444; color: white; border: none; border-radius: 0.375rem; cursor: pointer; font-size: 0.875rem;">
                                тєЎуюЪсѓњтЅіжЎц
                            </button>
                        </div>
                    `;
                    
                    // сЃЕсЃЎсЃФсЂ«сЃєсѓГсѓ╣сЃѕсѓњтцЅТЏ┤
                    if (label) {
                        label.textContent = 'тєЎуюЪсѓњтцЅТЏ┤';
                        label.style.background = '#10b981';
                        label.style.borderColor = '#10b981';
                    }
                };
                reader.readAsDataURL(file);
            } else {
                preview.innerHTML = '';
                if (label) {
                    label.textContent = 'тєЎуюЪсѓњжЂИТіъ';
                    label.style.background = '#2563eb';
                    label.style.borderColor = '#2563eb';
                }
            }
        }
        
        // тєЎуюЪсѓњтЅіжЎцсЂЎсѓІжќбТЋ░
        function removePhoto() {
            const input = document.getElementById('photoUpload');
            const preview = document.getElementById('photoPreview');
            const label = document.querySelector('label[for="photoUpload"]');
            
            input.value = '';
            preview.innerHTML = '';
            
            if (label) {
                label.textContent = 'тєЎуюЪсѓњжЂИТіъ';
                label.style.background = '#2563eb';
                label.style.borderColor = '#2563eb';
            }
        }
        
        // сЃЅсЃЕсЃЃсѓ░&сЃЅсЃГсЃЃсЃЌтЄдуљє
        function handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            const dropZone = document.getElementById('dropZone');
            dropZone.style.borderColor = '#2563eb';
            dropZone.style.background = '#eff6ff';
        }
        
        function handleDragLeave(event) {
            event.preventDefault();
            event.stopPropagation();
            const dropZone = document.getElementById('dropZone');
            dropZone.style.borderColor = '#d1d5db';
            dropZone.style.background = '#f9fafb';
        }
        
        function handleDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            
            const dropZone = document.getElementById('dropZone');
            dropZone.style.borderColor = '#d1d5db';
            dropZone.style.background = '#f9fafb';
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                const input = document.getElementById('photoUpload');
                
                // FileListсѓњУеГт«џ
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                input.files = dataTransfer.files;
                
                // сѓбсЃЃсЃЌсЃГсЃ╝сЃЅтЄдуљєсѓњт«ЪУАї
                handlePhotoUpload(input);
            }
        }
    </script>
</body>
</html>
